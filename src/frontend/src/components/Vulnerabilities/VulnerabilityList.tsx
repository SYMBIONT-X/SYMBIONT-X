import {
  makeStyles,
  shorthands,
  Text,
  Badge,
  Button,
  tokens,
  Tooltip,
} from '@fluentui/react-components';
import {
  ChevronRightRegular,
  OpenRegular,
  CheckmarkCircleRegular,
} from '@fluentui/react-icons';

const useStyles = makeStyles({
  container: {
    display: 'flex',
    flexDirection: 'column',
  },
  header: {
    display: 'grid',
    gridTemplateColumns: '1fr 100px 100px 120px 140px 100px',
    ...shorthands.gap('16px'),
    ...shorthands.padding('12px', '20px'),
    backgroundColor: tokens.colorNeutralBackground3,
    borderBottom: `1px solid ${tokens.colorNeutralStroke1}`,
  },
  headerCell: {
    fontWeight: tokens.fontWeightSemibold,
    fontSize: '12px',
    color: tokens.colorNeutralForeground3,
    textTransform: 'uppercase',
  },
  row: {
    display: 'grid',
    gridTemplateColumns: '1fr 100px 100px 120px 140px 100px',
    ...shorthands.gap('16px'),
    ...shorthands.padding('16px', '20px'),
    alignItems: 'center',
    borderBottom: `1px solid ${tokens.colorNeutralStroke2}`,
    cursor: 'pointer',
    transition: 'background-color 0.15s ease',
    ':hover': {
      backgroundColor: tokens.colorNeutralBackground2,
    },
  },
  cveInfo: {
    display: 'flex',
    flexDirection: 'column',
    ...shorthands.gap('4px'),
  },
  cveId: {
    fontWeight: tokens.fontWeightSemibold,
    color: tokens.colorBrandForeground1,
  },
  package: {
    display: 'flex',
    alignItems: 'center',
    ...shorthands.gap('4px'),
    fontSize: '13px',
    color: tokens.colorNeutralForeground3,
  },
  actions: {
    display: 'flex',
    justifyContent: 'flex-end',
    ...shorthands.gap('4px'),
  },
  emptyState: {
    display: 'flex',
    flexDirection: 'column',
    alignItems: 'center',
    justifyContent: 'center',
    ...shorthands.padding('48px'),
    color: tokens.colorNeutralForeground3,
  },
});

interface Vulnerability {
  id: string;
  cveId: string;
  package: string;
  version: string;
  severity: 'critical' | 'high' | 'medium' | 'low';
  cvss: number;
  status: 'open' | 'in_progress' | 'resolved';
  priority: 'P0' | 'P1' | 'P2' | 'P3';
  detectedAt: string;
}

// Mock data - will be replaced with real API data
const vulnerabilities: Vulnerability[] = [
  {
    id: '1',
    cveId: 'CVE-2026-12345',
    package: 'requests',
    version: '2.28.0',
    severity: 'critical',
    cvss: 9.8,
    status: 'in_progress',
    priority: 'P0',
    detectedAt: '2 hours ago',
  },
  {
    id: '2',
    cveId: 'CVE-2026-67890',
    package: 'lodash',
    version: '4.17.20',
    severity: 'high',
    cvss: 7.5,
    status: 'open',
    priority: 'P1',
    detectedAt: '5 hours ago',
  },
  {
    id: '3',
    cveId: 'CVE-2026-11111',
    package: 'axios',
    version: '0.21.1',
    severity: 'high',
    cvss: 7.2,
    status: 'in_progress',
    priority: 'P1',
    detectedAt: '1 day ago',
  },
  {
    id: '4',
    cveId: 'CVE-2026-22222',
    package: 'pyyaml',
    version: '5.4',
    severity: 'medium',
    cvss: 5.9,
    status: 'open',
    priority: 'P2',
    detectedAt: '2 days ago',
  },
  {
    id: '5',
    cveId: 'CVE-2026-33333',
    package: 'pillow',
    version: '8.0.0',
    severity: 'medium',
    cvss: 5.5,
    status: 'resolved',
    priority: 'P2',
    detectedAt: '3 days ago',
  },
  {
    id: '6',
    cveId: 'CVE-2026-44444',
    package: 'django',
    version: '3.2.0',
    severity: 'low',
    cvss: 3.7,
    status: 'open',
    priority: 'P3',
    detectedAt: '1 week ago',
  },
];

const severityColors = {
  critical: 'danger',
  high: 'warning', 
  medium: 'warning',
  low: 'success',
} as const;

const statusConfig = {
  open: { color: 'danger' as const, label: 'Open' },
  in_progress: { color: 'warning' as const, label: 'In Progress' },
  resolved: { color: 'success' as const, label: 'Resolved' },
};

export const VulnerabilityList: React.FC = () => {
  const styles = useStyles();

  if (vulnerabilities.length === 0) {
    return (
      <div className={styles.emptyState}>
        <CheckmarkCircleRegular style={{ fontSize: '48px', marginBottom: '16px' }} />
        <Text size={500} weight="semibold">No vulnerabilities found</Text>
        <Text size={300}>Your codebase is secure!</Text>
      </div>
    );
  }

  return (
    <div className={styles.container}>
      {/* Header */}
      <div className={styles.header}>
        <span className={styles.headerCell}>Vulnerability</span>
        <span className={styles.headerCell}>Severity</span>
        <span className={styles.headerCell}>CVSS</span>
        <span className={styles.headerCell}>Priority</span>
        <span className={styles.headerCell}>Status</span>
        <span className={styles.headerCell}>Actions</span>
      </div>

      {/* Rows */}
      {vulnerabilities.map((vuln) => (
        <div key={vuln.id} className={styles.row}>
          <div className={styles.cveInfo}>
            <Text className={styles.cveId}>{vuln.cveId}</Text>
            <div className={styles.package}>
              <span>{vuln.package}</span>
              <span>@{vuln.version}</span>
            </div>
          </div>

          <Badge
            size="small"
            appearance="tint"
            color={severityColors[vuln.severity]}
          >
            {vuln.severity}
          </Badge>

          <Text weight="semibold">{vuln.cvss}</Text>

          <Badge
            size="small"
            appearance="outline"
            color={vuln.priority === 'P0' ? 'danger' : vuln.priority === 'P1' ? 'warning' : 'informative'}
          >
            {vuln.priority}
          </Badge>

          <Badge
            size="small"
            appearance="filled"
            color={statusConfig[vuln.status].color}
          >
            {statusConfig[vuln.status].label}
          </Badge>

          <div className={styles.actions}>
            <Tooltip content="View Details" relationship="label">
              <Button
                appearance="subtle"
                icon={<ChevronRightRegular />}
                size="small"
              />
            </Tooltip>
            <Tooltip content="View in GitHub" relationship="label">
              <Button
                appearance="subtle"
                icon={<OpenRegular />}
                size="small"
              />
            </Tooltip>
          </div>
        </div>
      ))}
    </div>
  );
};
